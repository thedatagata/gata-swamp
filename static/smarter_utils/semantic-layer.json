{
  "version": 1,
  "sessions": {
    "table": "session_facts",
    "description": "Session-level analytics with 345K sessions for marketing performance tracking",
    "dimensions": {
      "session_id": {"column": "_.session_id", "type": "string", "description": "Unique session identifier"},
      "sesion_sequence_number": {"column": "_.session_sequence_number", "type":"integer", "description":"The session number for each cookie id"},
      "device_id": {"column": "_.device_id", "type": "string", "description": "Device identifier"},
      "cookie_id": {"column": "_.cookie_id", "type": "string", "description": "Cookie identifier for cross-session tracking"},
      "session_number": {"sql": "ROW_NUMBER() OVER (PARTITION BY _.cookie_id, _.device_id ORDER BY _.session_start_time)", "type": "integer", "description": "Session number for this device/cookie combination"},
      "session_date": {"column": "_.session_date", "type": "date", "description": "Session date", "is_time_dimension": true},
      "session_start_time": {"column": "_.session_start_time", "type": "timestamp", "description": "Session start timestamp", "is_time_dimension": true},
      "is_identified": {"column": "_.is_identified", "type": "boolean", "description": "Whether user is identified (has user_id)"},
      "is_customer": {"column": "_.is_customer", "type": "boolean", "description": "Whether user is a paying customer"},
      "plan_tier": {"column": "_.plan_tier", "type": "string", "description": "Subscription plan tier", "cardinality": "low", "values": ["", "starter", "premium", "enterprise"]},
      "traffic_source": {"column": "_.traffic_source", "type": "string", "description": "High-level traffic source", "cardinality": "low", "values": ["direct", "google_paid", "newsletter", "social", "organic", "referral"]},
      "max_lifecycle_stage": {"column": "_.max_lifecycle_stage", "type": "string", "description": "Furthest lifecycle stage reached in session", "cardinality": "low", "values": ["awareness", "interest", "consideration", "trial", "activation", "retention"]},
      "max_funnel_step": {"column": "_.max_funnel_step", "type": "integer", "description": "Furthest funnel step reached (1-7)"},
      "has_conversion": {"column": "_.has_conversion", "type": "boolean", "description": "Whether session resulted in conversion"},
      "reached_activation": {"column": "_.reached_activation", "type": "boolean", "description": "Whether session reached activation milestone"},
      "is_conversion_session": {"column": "_.is_conversion_session", "type": "boolean", "description": "Whether this was a conversion session"}
    },
    "measures": {
      "session_count": {"aggregation": "COUNT(*)", "description": "Total number of sessions", "format": "number"},
      "unique_visitors": {"aggregation": "COUNT(DISTINCT _.cookie_id)", "description": "Unique visitors (by cookie)", "format": "number"},
      "total_revenue": {"aggregation": "SUM(_.session_revenue)", "description": "Total revenue across all sessions", "format": "currency", "currency": "USD"},
      "revenue_per_visitor": {"aggregation": "SUM(_.session_revenue) / COUNT(DISTINCT _.cookie_id)", "description": "Revenue per unique visitor", "format": "currency", "currency": "USD", "decimals": 2},
      "conversion_rate": {"aggregation": "AVG(CASE WHEN _.has_conversion = TRUE THEN 100.0 ELSE 0.0 END)", "description": "Percentage of sessions with conversion", "format": "percentage", "decimals": 1},
      "activation_rate": {"aggregation": "AVG(CASE WHEN _.reached_activation = TRUE THEN 100.0 ELSE 0.0 END)", "description": "Percentage of sessions reaching activation", "format": "percentage", "decimals": 1},
      "conversions": {"aggregation": "SUM(CASE WHEN _.has_conversion = TRUE THEN 1 ELSE 0 END)", "description": "Total number of conversions", "format": "number"},
      "activations": {"aggregation": "SUM(CASE WHEN _.reached_activation = TRUE THEN 1 ELSE 0 END)", "description": "Total number of activations", "format": "number"},
      "awareness_events": {"aggregation": "SUM(_.awareness_events)", "description": "Total awareness stage events", "format": "number"},
      "interest_events": {"aggregation": "SUM(_.interest_events)", "description": "Total interest stage events", "format": "number"},
      "consideration_events": {"aggregation": "SUM(_.consideration_events)", "description": "Total consideration stage events", "format": "number"},
      "trial_events": {"aggregation": "SUM(_.trial_events)", "description": "Total trial stage events", "format": "number"},
      "activation_events": {"aggregation": "SUM(_.activation_events)", "description": "Total activation stage events", "format": "number"},
      "retention_events": {"aggregation": "SUM(_.retention_events)", "description": "Total retention stage events", "format": "number"},
      "expansion_events": {"aggregation": "SUM(_.expansion_events)", "description": "Total expansion events", "format": "number"},
      "revenue_last_30d": {"aggregation": "SUM(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 30 DAYS THEN _.session_revenue ELSE 0 END)", "description": "Revenue in last 30 days", "format": "currency", "currency": "USD"},
      "revenue_previous_30d": {"aggregation": "SUM(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 60 DAYS AND _.session_date < CURRENT_DATE - INTERVAL 30 DAYS THEN _.session_revenue ELSE 0 END)", "description": "Revenue in previous 30 days", "format": "currency", "currency": "USD"},
      "revenue_growth_rate": {"aggregation": "CASE WHEN SUM(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 60 DAYS AND _.session_date < CURRENT_DATE - INTERVAL 30 DAYS THEN _.session_revenue ELSE 0 END) > 0 THEN ((SUM(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 30 DAYS THEN _.session_revenue ELSE 0 END)::FLOAT / SUM(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 60 DAYS AND _.session_date < CURRENT_DATE - INTERVAL 30 DAYS THEN _.session_revenue ELSE 0 END)::FLOAT) - 1.0) * 100.0 ELSE 0.0 END", "description": "Revenue growth rate (last 30d vs previous 30d)", "format": "percentage", "decimals": 1},
      "sessions_last_30d": {"aggregation": "SUM(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 30 DAYS THEN 1 ELSE 0 END)", "description": "Sessions in last 30 days", "format": "number"},
      "sessions_previous_30d": {"aggregation": "SUM(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 60 DAYS AND _.session_date < CURRENT_DATE - INTERVAL 30 DAYS THEN 1 ELSE 0 END)", "description": "Sessions in previous 30 days", "format": "number"},
      "new_vs_returning_30d": {"aggregation": "ROUND(1.0 * (SUM(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 30 DAYS AND _.session_sequence_number = 1 THEN 1 ELSE 0 END) / SUM(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 30 DAYS AND _.session_sequence_number > 1 THEN 1 ELSE 0 END)),2)", "description":"New Visitors over Returning Visitors in the past 30 days", "format":"percentage", "decimals":2},
      "new_vs_returning_previous_30d": {"aggregation": "ROUND(1.0 * (SUM(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 60 DAYS AND _.session_date < CURRENT_DATE - INTERVAL 30 DAYS AND _.session_sequence_number = 1 THEN 1 ELSE 0 END) / SUM(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 60 DAYS AND _.session_date < CURRENT_DATE - INTERVAL 30 DAYS AND _.session_sequence_number > 1 THEN 1 ELSE 0 END)),2)","description":"New Visitors over Returning Visitors between 30 and 60 days from now", "format":"percentage", "decimals":2}, 
      "conversion_rate_last_30d": {"aggregation": "AVG(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 30 DAYS AND _.has_conversion = TRUE THEN 100.0 WHEN _.session_date >= CURRENT_DATE - INTERVAL 30 DAYS THEN 0.0 END)", "description": "Conversion rate in last 30 days", "format": "percentage", "decimals": 1},
      "conversion_rate_previous_30d": {"aggregation": "AVG(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 60 DAYS AND _.session_date < CURRENT_DATE - INTERVAL 30 DAYS AND _.has_conversion = TRUE THEN 100.0 WHEN _.session_date >= CURRENT_DATE - INTERVAL 60 DAYS AND _.session_date < CURRENT_DATE - INTERVAL 30 DAYS THEN 0.0 END)", "description": "Conversion rate in previous 30 days", "format": "percentage", "decimals": 1},
      "conversion_rate_change": {"aggregation": "AVG(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 30 DAYS AND _.has_conversion = TRUE THEN 100.0 WHEN _.session_date >= CURRENT_DATE - INTERVAL 30 DAYS THEN 0.0 END) - AVG(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 60 DAYS AND _.session_date < CURRENT_DATE - INTERVAL 30 DAYS AND _.has_conversion = TRUE THEN 100.0 WHEN _.session_date >= CURRENT_DATE - INTERVAL 60 DAYS AND _.session_date < CURRENT_DATE - INTERVAL 30 DAYS THEN 0.0 END)", "description": "Change in conversion rate (percentage points)", "format": "percentage", "decimals": 1},
      "activation_last_30d": {"aggregation": "SUM(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 30 DAYS AND _.max_lifecycle_stage IN ('trial', 'activation') THEN 1 ELSE 0 END)", "description": "Activations in last 30 days", "format": "number"},
      "activation_previous_30d": {"aggregation": "SUM(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 60 DAYS AND _.session_date < CURRENT_DATE - INTERVAL 30 DAYS AND _.max_lifecycle_stage IN ('trial', 'activation') THEN 1 ELSE 0 END)", "description": "Activations in previous 30 days", "format": "number"},
      "activation_growth_rate": {"aggregation": "CASE WHEN SUM(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 60 DAYS AND _.session_date < CURRENT_DATE - INTERVAL 30 DAYS AND _.max_lifecycle_stage IN ('trial', 'activation') THEN 1 ELSE 0 END) > 0 THEN ((SUM(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 30 DAYS AND _.max_lifecycle_stage IN ('trial', 'activation') THEN 1 ELSE 0 END)::FLOAT / SUM(CASE WHEN _.session_date >= CURRENT_DATE - INTERVAL 60 DAYS AND _.session_date < CURRENT_DATE - INTERVAL 30 DAYS AND _.max_lifecycle_stage IN ('trial', 'activation') THEN 1 ELSE 0 END)::FLOAT) - 1.0) * 100.0 ELSE 0.0 END", "description": "Activation growth rate", "format": "percentage", "decimals": 1}
    }
  },
  "users": {
    "table": "users_dim",
    "description": "User-level analytics with 235K users for cohort and retention analysis",
    "dimensions": {
      "user_key": {"column": "_.user_key", "type": "string", "description": "Primary user identifier (cookie or user_id)"},
      "user_id": {"column": "_.user_id", "type": "string", "description": "Authenticated user ID (2.35% identified)"},
      "first_device_id": {"column": "_.first_device_id", "type": "string", "description": "Device ID of first session"},
      "last_device_id": {"column": "_.last_device_id", "type": "string", "description": "Device ID of most recent session"},
      "first_event_date": {"column": "_.first_event_date", "type": "date", "description": "User acquisition date (cohort)", "is_time_dimension": true},
      "first_event_time": {"column": "_.first_event_time", "type": "timestamp", "description": "First event timestamp", "is_time_dimension": true},
      "last_event_date": {"column": "_.last_event_date", "type": "date", "description": "Most recent activity date", "is_time_dimension": true},
      "last_event_time": {"column": "_.last_event_time", "type": "timestamp", "description": "Most recent activity timestamp", "is_time_dimension": true},
      "current_plan_tier": {"column": "_.current_plan_tier", "type": "string", "description": "Current subscription plan", "cardinality": "low", "values": ["", "starter", "premium", "enterprise"]},
      "max_lifecycle_stage": {"column": "_.max_lifecycle_stage", "type": "integer", "description": "Furthest lifecycle stage reached (numeric)"},
      "max_lifecycle_stage_name": {"column": "_.max_lifecycle_stage_name", "type": "string", "description": "Furthest lifecycle stage reached", "cardinality": "low", "values": ["awareness", "interest", "consideration", "trial", "activation", "retention"]},
      "has_activated": {"column": "_.has_activated", "type": "boolean", "description": "Whether user has reached activation"},
      "is_paying_customer": {"column": "_.is_paying_customer", "type": "boolean", "description": "Whether user is currently paying"},
      "is_active_7d": {"column": "_.is_active_7d", "type": "boolean", "description": "Active in last 7 days"},
      "is_active_30d": {"column": "_.is_active_30d", "type": "boolean", "description": "Active in last 30 days"},
      "first_touch_utm_source": {"column": "_.first_touch_utm_source", "type": "string", "description": "First touch UTM source", "cardinality": "low"},
      "first_touch_utm_medium": {"column": "_.first_touch_utm_medium", "type": "string", "description": "First touch UTM medium", "cardinality": "low"},
      "first_touch_utm_campaign": {"column": "_.first_touch_utm_campaign", "type": "string", "description": "First touch UTM campaign", "cardinality": "medium"},
      "last_touch_utm_source": {"column": "_.last_touch_utm_source", "type": "string", "description": "Last touch UTM source", "cardinality": "low"},
      "last_touch_utm_medium": {"column": "_.last_touch_utm_medium", "type": "string", "description": "Last touch UTM medium", "cardinality": "low"},
      "last_touch_utm_campaign": {"column": "_.last_touch_utm_campaign", "type": "string", "description": "Last touch UTM campaign", "cardinality": "medium"},
      "days_active_span": {"column": "_.days_active_span", "type": "integer", "description": "Days between first and last event"},
      "days_since_last_event": {"column": "_.days_since_last_event", "type": "integer", "description": "Days since last activity"}
    },
    "measures": {
      "user_count": {"aggregation": "COUNT(*)", "description": "Total users", "format": "number"},
      "paying_customers": {"aggregation": "SUM(CASE WHEN _.is_paying_customer = TRUE THEN 1 ELSE 0 END)", "description": "Count of paying customers", "format": "number"},
      "activated_users": {"aggregation": "SUM(_.has_activated)", "description": "Users who reached activation", "format": "number"},
      "active_users_7d": {"aggregation": "SUM(CASE WHEN _.is_active_7d = TRUE THEN 1 ELSE 0 END)", "description": "Users active in last 7 days", "format": "number"},
      "active_users_30d": {"aggregation": "SUM(CASE WHEN _.is_active_30d = TRUE THEN 1 ELSE 0 END)", "description": "Users active in last 30 days", "format": "number"},
      "total_ltv": {"aggregation": "SUM(_.total_revenue)", "description": "Total lifetime value across all users", "format": "currency", "currency": "USD"},
      "avg_ltv": {"aggregation": "AVG(_.total_revenue)", "description": "Average lifetime value per user", "format": "currency", "currency": "USD", "decimals": 2},
      "avg_ltv_paying": {"aggregation": "AVG(CASE WHEN _.is_paying_customer = TRUE THEN _.total_revenue END)", "description": "Average LTV of paying customers", "format": "currency", "currency": "USD", "decimals": 2},
      "total_revenue_7d": {"aggregation": "SUM(_.revenue_7d)", "description": "Revenue from users in last 7 days", "format": "currency", "currency": "USD"},
      "total_revenue_30d": {"aggregation": "SUM(_.revenue_30d)", "description": "Revenue from users in last 30 days", "format": "currency", "currency": "USD"},
      "total_revenue_90d": {"aggregation": "SUM(_.revenue_90d)", "description": "Revenue from users in last 90 days", "format": "currency", "currency": "USD"},
      "avg_sessions_per_user": {"aggregation": "AVG(_.total_sessions)", "description": "Average sessions per user", "format": "number", "decimals": 1},
      "avg_events_per_user": {"aggregation": "AVG(_.total_events)", "description": "Average events per user", "format": "number", "decimals": 1},
      "avg_days_active": {"aggregation": "AVG(_.total_days_active)", "description": "Average days active per user", "format": "number", "decimals": 1},
      "avg_lifecycle_stage": {"aggregation": "AVG(_.max_lifecycle_stage)", "description": "Average lifecycle stage (numeric)", "format": "number", "decimals": 2},
      "new_users": {"aggregation": "SUM(CASE WHEN _.first_event_date >= CURRENT_DATE - INTERVAL 30 DAYS THEN 1 ELSE 0 END)", "description": "Users acquired in last 30 days", "format": "number"},
      "new_users_7d": {"aggregation": "SUM(CASE WHEN _.first_event_date >= CURRENT_DATE - INTERVAL 7 DAYS THEN 1 ELSE 0 END)", "description": "Users acquired in last 7 days", "format": "number"},
      "returning_users": {"aggregation": "SUM(CASE WHEN _.first_event_date BETWEEN CURRENT_DATE - INTERVAL 90 DAYS AND CURRENT_DATE - INTERVAL 30 DAYS AND _.is_active_30d = TRUE THEN 1 ELSE 0 END)", "description": "Users acquired 30-90 days ago still active", "format": "number"},
      "retention_rate_7d": {"aggregation": "AVG(CASE WHEN _.is_active_7d = TRUE THEN 100.0 ELSE 0.0 END)", "description": "7-day retention rate", "format": "percentage", "decimals": 1},
      "retention_rate_30d": {"aggregation": "AVG(CASE WHEN _.is_active_30d = TRUE THEN 100.0 ELSE 0.0 END)", "description": "30-day retention rate", "format": "percentage", "decimals": 1},
      "activation_rate": {"aggregation": "AVG(CASE WHEN _.has_activated = 1 THEN 100.0 ELSE 0.0 END)", "description": "Percentage of users who activated", "format": "percentage", "decimals": 1},
      "customer_conversion_rate": {"aggregation": "AVG(CASE WHEN _.is_paying_customer = TRUE THEN 100.0 ELSE 0.0 END)", "description": "Percentage of users who became customers", "format": "percentage", "decimals": 1},
      "avg_days_to_activation": {"aggregation": "AVG(CASE WHEN _.has_activated = 1 THEN _.days_active_span END)", "description": "Average days from signup to activation", "format": "number", "decimals": 1},
      "avg_session_frequency": {"aggregation": "AVG(_.total_sessions / NULLIF(_.total_days_active, 0))", "description": "Average sessions per active day", "format": "number", "decimals": 2},
      "new_vs_returning_rate": {"aggregation": "AVG(CASE WHEN _.first_event_date >= CURRENT_DATE - INTERVAL 30 DAYS THEN 100.0 ELSE 0.0 END)", "description": "Percentage of users that are new (last 30 days)", "format": "percentage", "decimals": 1},
      "activation_rate_last_30d": {"aggregation": "AVG(CASE WHEN _.max_lifecycle_stage_name = 'activation' AND _.last_event_time >= CURRENT_DATE - INTERVAL 30 DAYS THEN 100.0 WHEN _.last_event_time >= CURRENT_DATE - INTERVAL 30 DAYS THEN 0.0 END)", "description": "Activation rate for users active in last 30 days", "format": "percentage", "decimals": 1},
      "activation_rate_previous_30d": {"aggregation": "AVG(CASE WHEN _.max_lifecycle_stage_name = 'activation' AND _.last_event_time >= CURRENT_DATE - INTERVAL 60 DAYS AND _.last_event_time < CURRENT_DATE - INTERVAL 30 DAYS THEN 100.0 WHEN _.last_event_time >= CURRENT_DATE - INTERVAL 60 DAYS AND _.last_event_time < CURRENT_DATE - INTERVAL 30 DAYS THEN 0.0 END)", "description": "Activation rate for users active in previous 30 days", "format": "percentage", "decimals": 1},
      "avg_deal_size_last_30d": {"aggregation": "AVG(CASE WHEN _.last_event_time >= CURRENT_DATE - INTERVAL 30 DAYS THEN _.revenue_30d END)", "description": "Average revenue per user active in last 30 days", "format": "currency", "currency": "USD", "decimals": 2},
      "avg_deal_size_previous_30d": {"aggregation": "AVG(CASE WHEN _.last_event_time >= CURRENT_DATE - INTERVAL 60 DAYS AND _.last_event_time < CURRENT_DATE - INTERVAL 30 DAYS THEN _.revenue_30d END)", "description": "Average revenue per user active in previous 30 days", "format": "currency", "currency": "USD", "decimals": 2},
      "active_customers_last_30d": {"aggregation": "SUM(CASE WHEN _.last_event_time >= CURRENT_DATE - INTERVAL 30 DAYS AND _.revenue_30d > 0 THEN 1 ELSE 0 END)", "description": "Customers with revenue and activity in last 30 days", "format": "number"},
      "active_customers_previous_30d": {"aggregation": "SUM(CASE WHEN _.last_event_time >= CURRENT_DATE - INTERVAL 60 DAYS AND _.last_event_time < CURRENT_DATE - INTERVAL 30 DAYS AND _.revenue_30d > 0 THEN 1 ELSE 0 END)", "description": "Customers with revenue and activity in previous 30 days", "format": "number"}
    }
  },
  "charts": {
    "sessions_over_time": {"model": "sessions", "type": "line", "title": "Sessions Over Time", "dimensions": ["session_date"], "measures": ["session_count", "unique_visitors"]},
    "traffic_breakdown": {"model": "sessions", "type": "bar", "title": "Sessions by Traffic Source", "dimensions": ["traffic_source"], "measures": ["session_count", "conversion_rate", "total_revenue"]},
    "lifecycle_funnel": {"model": "sessions", "type": "funnel", "title": "Lifecycle Funnel", "dimensions": ["max_lifecycle_stage"], "measures": ["unique_visitors"]},
    "cohort_retention": {"model": "sessions", "type": "heatmap", "title": "Post-Activation Cohort Retention", "description": "Weekly retention by activation cohort (26 weeks)"},
    "engagement_retention": {"model": "users", "type": "line", "title": "Engagement Retention by Cohort", "description": "Percentage of available days active by signup week"},
    "attribution_analysis": {"model": "users", "type": "bar", "title": "First Touch Attribution", "dimensions": ["first_touch_utm_source"], "measures": ["user_count", "total_ltv", "paying_customers"]}
  }
}